{% extends "base.html" %}
{% block content %}


<section class="container">
    <div class="row mt-3">
        <div class="card col-12 col-md-8 offset-md-2" method="POST" action="{{ url_for('login') }}">
            <div class="card-body">
                <h2 class="text-center mt-5 mb-4">{{ username.title() }}'s Profile</h2>
            </div>
        </div>
    </div>
    </div>
</section>

<!-- Journal -->
<div class="py-2 text-center container bg-light" style="border-radius:5%;">
    <div class="row mb-2">
      <h2 class="fw-light mt-5">Daily Gratitude Journal</h2>
      <p class="lead text-muted">Say thank you and celebrate.<br>
        Acknowledging the good that you already have in your life is the foundation for all abundance.</p>
    </div>
    <div class="row mb-2">
      <div class="col-12 col-md-6 mt-5">
        <img src="/static/assets/img/journal_img.png" class="bd-placeholder-img mt-5" alt="pink agenda" style="width:100%; height:auto; border-radius:2%;">
      </div>
      <div class="col-12 col-md-6">
      {% if session.user %} 
        {% include 'journal_form.html' %}
      {% endif %}  
      </div>
    </div>
</div>


<section>
    <div class="row mt-5">
        <div class="col-6 px-5">
            <div class="row">
                <div class="col-6">
                    <h3>Attending:</h3>
                </div>
                <div class="col-6">
                    <a class="btn btn-primary btn-md float-end" href="{{ url_for('get_events') }}">Explore Events</a>
                </div>
            </div>
            <hr>
            {% for event in events %}
            <!-- Find users saved events -->
                {% if username in event.members_attending %}
                    <p class="text-muted">{{event.event_date|format_date }}</p>
                    <h5>{{ event.event_name }}</h5>
                    <p class="text-muted">{{ event.event_description }}</p>
                    <p class="text-muted">{{ event.event_place }}</p>
                    <hr>
                {% endif %}     
            {% endfor %}
        </div>
        <div class="col-6 px-5">
            <div class="row">
                <div class="col-6">
                    <h3>Events Created:</h3>
                </div>
                <div class="col-6">
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-primary btn-md float-end" data-bs-toggle="modal" data-bs-target="#exampleModal">
                        Create Event
                    </button>
                </div>
            </div>
            <hr>
            {% for event in events %}
                <!-- Find users created events -->
                {% if username == event.event_owner %}
                    <p class="text-muted">{{event.event_date|format_date }}</p>
                    <h5>{{ event.event_name }}</h5>
                    <p class="text-muted">{{ event.event_description }}</p>
                    <p class="text-muted">{{ event.event_place }}</p>
                    <a class="btn btn-secondary btn-md" href="{{url_for('edit_event',id=event._id)}}">Edit Event</a>
                    <a class="btn btn-danger btn-md" href="{{url_for('delete_event',id=event._id)}}">Delete Event</a>
                    <br>
                    <hr>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</section>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Create New Event</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <form method="POST" action="{{url_for('new_event')}}">
                <div class="input-field">
                    <label for="event_name">Event Name</label>
                    <input id="event_name" name="event_name" type="text" class="validate" pattern="^[a-ZA-Z0-9]$" minlength="5"
                        required>
                </div>
                <div class="input-field">
                    <label for="event_place">Event Location</label>
                    <input id="event_place" name="event_place" type="text" required>
                </div>
                <div class="input-field">
                    <label for="event_date">Date & Time</label>
                    <input id="event_date" name="event_date" type="datetime-local" required>
                </div>
                <div class="input-field">
                    <label for="event_description">Description</label>
                    <input id="event_description" name="event_description" type="text" required>
                </div>
                
            </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Create</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
    var myModal = document.getElementById('myModal')
    var myInput = document.getElementById('myInput')

    myModal.addEventListener('shown.bs.modal', function () {
        myInput.focus()
    })
</script>
{% endblock %}